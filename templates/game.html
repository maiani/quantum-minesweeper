<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quantum Minesweeper â€“ Game</title>
  <style>
    :root {
      --bg: #0b0b0b;
      --fg: #eaeaea;
      --card: #141414;
      --border: #232323;
      --tile: #151515;
      --tile-muted: #777;
      --accent: #2b6cb0;
      --accent-2: #2c77c5;
      --boom: #c1121f;
      --pin: #e6c229;
      --zero-bg: #111;
      --tool-bg: #101010;
      --tool-active: #23385b;
    }
    .light {
      --bg: #ffffff;
      --fg: #111111;
      --card: #f5f5f5;
      --border: #dddddd;
      --tile: #fafafa;
      --tile-muted: #8a8a8a;
      --accent: #2563eb;
      --accent-2: #3b82f6;
      --boom: #b91c1c;
      --pin: #b7791f;
      --zero-bg: #f1f5f9;
      --tool-bg: #f0f0f0;
      --tool-active: #dbeafe;
    }
    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--fg); }
    .wrap { max-width: 960px; margin: 2rem auto; padding: 0 1rem; }
    h3 { margin: .2rem 0 1rem 0; color: #7dd3fc; }

    .toolbar { display:flex; gap:.5rem; align-items:center; margin-bottom: 1rem; flex-wrap: wrap; }
    .toolbar form { margin:0; }
    .btn { padding:.55rem .8rem; background: var(--card); border:1px solid var(--border); color: var(--fg); border-radius:8px; cursor:pointer; }
    .btn:hover { filter: brightness(1.05); }
    .btn.primary { background: var(--accent); color:#fff; border-color: transparent; }
    .btn.primary:hover { background: var(--accent-2); }

    .toolset { display:flex; gap:.4rem; padding:.35rem; background: var(--tool-bg); border:1px solid var(--border); border-radius:10px; }
    .toolbtn { padding:.45rem .7rem; border-radius: 7px; background: transparent; border:1px solid transparent; color: var(--fg); cursor:pointer; }
    .toolbtn.active { background: var(--tool-active); border-color: transparent; font-weight: 700; }
    .toolbtn:hover { filter: brightness(1.1); }

    .grid { display:grid; gap:4px; background: var(--card); padding:6px; border:1px solid var(--border); border-radius:10px; width: fit-content; }
    .cell form { margin:0; }
    .cell button { width:44px; height:44px; border-radius:6px; border:1px solid var(--border); background: var(--tile); color: var(--fg); font-weight:700; cursor:pointer; }
    .cell button:hover { filter: brightness(1.07); }

    .status { margin-top:.6rem; color:#a1a1aa; }
    .row { display:contents; }
  </style>
</head>
<body class="{{ 'light' if theme=='light' else '' }}">
  <div class="wrap">
    <h3>Status: {{ status }}</h3>

    <div class="toolbar">
      <form method="post" action="{{ url_for('game') }}">
        <input type="hidden" name="action" value="reset">
        <button class="btn" type="submit">Reset Board</button>
      </form>
      <form method="post" action="{{ url_for('game') }}">
        <input type="hidden" name="action" value="new_same">
        <button class="btn" type="submit">New Game (Same Rules)</button>
      </form>
      <form method="post" action="{{ url_for('game') }}">
        <input type="hidden" name="action" value="new_rules">
        <button class="btn" type="submit">New Game (New Rules)</button>
      </form>

      <div style="flex:1"></div>

      <!-- Theme toggle -->
      <form method="post" action="{{ url_for('game') }}">
        <input type="hidden" name="action" value="toggle_theme">
        <button class="btn" type="submit">{{ 'Dark' if theme=='light' else 'Light' }} Theme</button>
      </form>
    </div>

    <!-- Tool buttons -->
    <div class="toolbar">
      <div class="toolset" id="toolset">
        {% for t in tools %}
          <form method="post" action="{{ url_for('game') }}">
            <input type="hidden" name="action" value="set_tool">
            <input type="hidden" name="tool" value="{{ t }}">
            <button type="submit" class="toolbtn {{ 'active' if current_tool==t else '' }}" data-tool="{{ t }}">
              {{ t }}
            </button>
          </form>
        {% endfor %}
      </div>
    </div>

    <!-- Board -->
    <div class="grid" style="grid-template-columns: repeat({{ cols }}, 48px);">
      {% for row in grid %}
        <div class="row">
        {% for cell in row %}
          <div class="cell">
            <form method="post" action="{{ url_for('game') }}">
              <input type="hidden" name="action" value="cell">
              <input type="hidden" name="r" value="{{ cell.r }}">
              <input type="hidden" name="c" value="{{ cell.c }}">
              <button type="submit" style="{{ cell.style }}">{% autoescape false %}{{ cell.text }}{% endautoescape %}</button>
            </form>
          </div>
        {% endfor %}
        </div>
      {% endfor %}
    </div>

    <div class="status">
      Active move: <strong>{{ current_tool }}</strong>.  
      Keyboard: <code>M</code>, <code>P</code>, <code>X</code>, <code>Y</code>, <code>Z</code>, <code>H</code>, <code>S</code> to switch tool.
    </div>
  </div>

  <script>
    // Keyboard shortcuts to switch tool without mouse:
    // Posts a tiny form to set tool (causes a quick reload to reflect active state)
    const allowed = new Set({{ tools|tojson }});
    document.addEventListener('keydown', (e) => {
      const k = e.key.toUpperCase();
      if (allowed.has(k)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("game") }}';
        form.innerHTML = `
          <input type="hidden" name="action" value="set_tool">
          <input type="hidden" name="tool" value="${k}">
        `;
        document.body.appendChild(form);
        form.submit();
      }
    }, { passive: true });
  </script>
</body>
</html>
