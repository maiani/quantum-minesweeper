{% extends "base.html" %}
{% block title %}Game â€” Quantum Minesweeper{% endblock %}

{% block content %}
<h1>Quantum Minesweeper</h1>
<h2>Status: {{ status }}</h2>

<!-- Board -->
<form action="/game" method="post">
  <table class="board">
    {% for r in range(rows) %}
    <tr>
      {% for c in range(cols) %}
      <td>
        {% if status == "ONGOING" %}
        <button type="submit"
                name="action" value="cell"
                formaction="/game?r={{r}}&c={{c}}"
                style="{{ grid[r][c]['style'] }}">
          {{ grid[r][c]['text']|safe }}
        </button>
        {% else %}
        <button disabled
                style="{{ grid[r][c]['style'] }}">
          {{ grid[r][c]['text']|safe }}
        </button>
        {% endif %}
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </table>
</form>

<!-- Tools (only if game ongoing) -->
{% if status == "ONGOING" %}
<h3>Tools</h3>
<form action="/game" method="post" class="tools">
  {% for t in tools %}
    <button type="submit"
            name="action" value="set_tool"
            formaction="/game?tool={{t}}"
            {% if current_tool == t %}class="active"{% endif %}>
      {{ t }}
    </button>
  {% endfor %}
</form>
{% endif %}

<!-- Actions -->
{% if status == "ONGOING" %}
<h3>Actions</h3>
<form action="/game" method="post">
  <button type="submit" name="action" value="reset" formaction="/game">Reset Board</button>
  <button type="submit" name="action" value="new_same" formaction="/game">New Board (same rules)</button>
  <button type="submit" name="action" value="new_rules" formaction="/game">New Setup</button>
  <button type="submit" name="action" value="toggle_theme" formaction="/game">Toggle Theme</button>
</form>
{% else %}
<div class="gameover-overlay">
  <div class="gameover-box">
    <h2>Game Over!</h2>
    <div class="actions">
      <form action="/game" method="post">
        <button type="submit" name="action" value="reset" formaction="/game">Reset Board</button>
        <button type="submit" name="action" value="new_same" formaction="/game">New Board</button>
        <button type="submit" name="action" value="new_rules" formaction="/game">New Setup</button>
      </form>
    </div>
  </div>
</div>
{% endif %}

</form>
{% endblock %}
